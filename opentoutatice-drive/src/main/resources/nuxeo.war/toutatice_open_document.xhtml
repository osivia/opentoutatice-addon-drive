<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<nxthemes:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:nxthemes="http://nuxeo.org/nxthemes"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:nxl="http://nuxeo.org/nxforms/layout"
	xmlns:nxh="http://nuxeo.org/nxweb/html"
	xmlns:nxd="http://nuxeo.org/nxweb/document"
	xmlns:nxu="http://nuxeo.org/nxweb/util"
	xmlns:c="http://java.sun.com/jstl/core">


	<ui:define name="header_scripts">
		<link href="#{baseURL}css/bootstrap.min.css" type="text/css"
			rel="stylesheet" />
		<script type="text/javascript"
			src="#{baseURL}scripts/bootstrap-progressbar.min.js"></script>

		<script type="text/javascript">		waitBeforeDownload();
		
		var currTime = 0;
		var status = 0;
				
		function waitBeforeDownload() {
			
			currTime = currTime + 1;
			status = (currTime / #{driveBean.openDelay}) * 100;
			
			jQuery('.progress .progress-bar').attr('data-transitiongoal', status).progressbar(
					{display_text: 'fill',
						transition_delay: 0});
			
			if(status >= 100 ) {
				console.log(status);
				jQuery('#div-progress').css('display', 'none');
				jQuery('#div-success').css('display', '');
				document.getElementById("download_frame").src="#{driveBean.driveLink}"; 
			}
			else {
				setTimeout("waitBeforeDownload()",1000);
			}
		}

		-->
		</script>
	</ui:define>

	<ui:define name="body">

		<div class="container">

			<h1>Ouverture du document</h1>
			<h:form id="drive_form">



				<div id="div-progress">
					<h2>
						<img src="#{baseURL}/img/standart_waiter.gif" /> &nbsp; Votre
						document est en cours de téléchargement
					</h2>

					<p>Il sera accessible dans #{driveBean.openDelay} secondes.</p>

					<p>
						<nxh:graphicImage value="#{nxd:fileIconPath(driveBean.blob)}"
							rendered="#{! empty nxd:fileIconPath(driveBean.blob)}" />
						#{driveBean.blob.filename} #{driveBean.blob.length} octets)
					</p>

					<hr />
					<div class="progress">
						<div id="progress-bar-download"
							class="progress-bar progress-bar-striped active"
							role="progressbar" data-transitiongoal="0"></div>
					</div>
					<hr />
				</div>

				<div id="div-success" style="display: none">
					<div class="alert alert-success" role="success">
						<h2>Votre document est téléchargé et en cours d'ouverture.</h2>				
					</div>
					<hr />
					<p>
						Si rien ne se passe, veuillez cliquer sur ce lien : <a
							href="#{driveBean.driveLink}"> <nxh:graphicImage
								value="#{nxd:fileIconPath(driveBean.blob)}"
								rendered="#{! empty nxd:fileIconPath(driveBean.blob)}" />
							#{driveBean.blob.filename}
						</a> #{driveBean.blob.length} octets)
					</p>
					<hr />

				</div>

				<iframe width="1" height="1" frameborder="0" id="download_frame"></iframe>



				<div class="alert alert-info" role="alert">.Vous devez avoir
					installé le Drive sur votre poste !</div>




			</h:form>

		</div>

	</ui:define>

</nxthemes:composition>
